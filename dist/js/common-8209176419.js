/**
 * Date:Sun Nov 27 2016 17:17:12 GMT+0800 (中国标准时间)
 */
function search(){var e=$(".search input").val();if(e){var t="/search?keyword="+e+"&pageNum=1&type=1&"+$("#source").val();localStorage.setItem("keyword",e),window.pageload(t),history.pushState("","",t)}else alert("请输入关键字搜索")}function searchForTop(e){var t=$(".searchForTop").val(),a="/search?keyword="+t+"&pageNum=1&type=1&"+e;localStorage.setItem("keyword",t),window.pageload(a),history.pushState("","",a)}function search2(){var e=$(".searchbar input").val(),t=window.location.search.indexOf("search"),a="";e?(a=t>-1?"/search?keyword="+e+"&pageNum=1&type="+($(".tab .active").index()+1)+"&search=yes&"+$("#source").val():"/search?keyword="+e+"&pageNum=1&type="+($(".tab .active").index()+1)+"&"+$("#source").val(),localStorage.setItem("keyword",e),window.pageload(a),history.pushState("","",a)):alert("请输入关键字搜索")}var u=navigator.userAgent;window.browser={trident:u.indexOf("Trident")>-1,presto:u.indexOf("Presto")>-1,webKit:u.indexOf("AppleWebKit")>-1,gecko:u.indexOf("Gecko")>-1&&u.indexOf("KHTML")==-1,mobile:!!u.match(/AppleWebKit.*Mobile.*/),ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf("Android")>-1||u.indexOf("Linux")>-1,iPhone:u.indexOf("iPhone")>-1,iPad:u.indexOf("iPad")>-1,webApp:u.indexOf("Safari")==-1,isWebchat:/micromessenger/i.test(u),isWeiboChat:/weibo/i.test(u)},function(){location.href.indexOf("group")>-1&&$("#J_topDownload").html("下载客户端，报名参加听友会活动")}(),function(e){function t(e){this.url=e.url,this.realPic=e.realPic,this.successFn=e.successFn,this.init()}t.prototype={init:function(){this.getData()},getHtml:function(){return'<div class="pic-mask"></div><div class="carrousel"><div class="_wrappers"> <img src="/images/loading_cover-0f41c67c1f.jpg" alt=""> </div></div>'},openDialog:function(){var e=this,t=this.getHtml();$("body").append(t),e.setWidth(),e.bindEvent()},setWidth:function(){var e=parseInt(.85*$(document).width())+"px";$("._wrappers").css({width:e})},bindEvent:function(){$(".pic-mask,._wrappers").on("touchstart click",function(e){$(".carrousel").remove(),$(".pic-mask").remove(),e.preventDefault()})},beforeSend:function(){this.openDialog()},getData:function(){var e=this,t=!0;if(t)return e.beforeSend(),e.realPic?void e.successFn(e.realPic):void $.ajax({url:e.url,type:"get",beforeSend:function(){t=!1},success:function(a){t=!0,0==a.status&&"function"==typeof e.successFn&&e.successFn(a.picUrl)},error:function(e){console.log(e),t=!0}})}},e.OpenBigPic=t}(window),$(function(){function e(){return window.playerInfo.sections}var t={init:function(){this.initPlatform(),this.setHeaderHeight()},initPlatform:function(){var e=$(document.body),t=navigator.userAgent.toLowerCase();return t.indexOf("android 2.3")>-1&&e.addClass("low-version"),window.browser.android&&e.addClass("page-android"),window.browser.ios&&e.addClass("page-ios"),this},setHeaderHeight:function(){$("header").height($(".fixednav").height())}};t.init();var a=function(){$("img.lazy").each(function(){$(this).hasClass("lazy_spe")?$("img.lazy").lazyload({threshold:100}):$(this).attr("src",$(this).data("original"))})},n=function(){a(),$(".tab li").on("click",function(){var e=$(this);e.addClass("active").siblings().removeClass("active");var t=e.index();$(".tab-content").children().eq(t).show().siblings().hide()});var e=$(".g-btn-aside");e.on("click",function(){e.hasClass("disable")||($(".wrapper").toggleClass("aside-out"),1==$(".aside-out").length&&($(".article-overlayer").show().height($(document).height()),window.myScroll||(window.myScroll=new IScroll("#aside",{hScroll:!1,freeScroll:!0,click:!0}))))}),$(".article-overlayer").on("touchstart",function(t){$(".aside-out").removeClass("aside-out"),t.stopPropagation(),t.preventDefault(),e.addClass("disable"),setTimeout(function(){e.removeClass("disable")},500)}),$("aside a").on("click",function(){$(".wrapper").toggleClass("aside-out")}),$(".g-goback").on("click",function(){history.length&&history.length<=1?window.pageload("/"):window.history.go(-1)}),$(".top-download-close").on("click",function(){$(".top-download").hide()}),$(".search input").on("focus",function(){$(".search").addClass("search-focus")}).on("blur",function(){$(".search-focus").removeClass("search-focus")})};n(),top==window&&$.ajax({url:"/ajax/category",cache:!0,success:function(e){var t=$("#source").val();if(e){var a="";e=e.list;for(var n=0;n<e.length;n++)a+=1==e[n].type?'<li><a href="/book/category/child/'+e[n].id+"?sort=2&pageNum=1&name="+e[n].name+"&"+t+'">'+e[n].name+"</a></li>":'<li><a href="/book/category/'+e[n].id+"?name="+e[n].name+"&"+t+'">'+e[n].name+"</a></li>";$(".main-category ul").html(a)}}});var i=$(".page-loading-bar"),o=window.pageload=function(e,t){e+=e.indexOf("?")==-1?"?":"&",$(".wrapper").removeClass("aside-out").css("opacity",.7),i.show().css("width","80%");var a=document.createElement("iframe");a.style.display="none",a.src=e,a.onload=function(){$.fn.fullpage&&$.fn.fullpage.destroy(),$(".wrapper").css("opacity",1),i.show().css("width","100%"),setTimeout(function(){i.hide().width(0)},500);var e=this.contentWindow.document;document.title=e.title,window.setupNavBarTitle&&window.setupNavBarTitle(e.title),e.getElementsByTagName("article")[0]?$("article").html(e.getElementsByTagName("article")[0].innerHTML):$("article").html(e.body.innerHTML),$("header").height($(".fixednav").height()),n();var o=this.contentWindow.script,r=this.contentWindow.document.styleSheets;if(r.length)for(var s=0,l=r.length;s<l;s++)r[s].href&&r[s].href.indexOf("/h5/")>-1&&0==$("#h5Css").length&&$("head").append('<link rel="stylesheet" id="h5Css" href="'+r[s].href+'" type="text/css">');o&&seajs&&seajs.use(o,function(e){e.ready()}),window.scrollTo(0,1),$(".g-gotop").hide(),$(a).remove(),t&&"function"==typeof t&&t();var d=$(".searchbar input");if(1==d.length){var c=window.location.search.indexOf("embedApp");if(c>-1){var u=localStorage.getItem("keyword");u?d.attr("placeholder",u):($(".search-empty").find(".big").text("请输入搜索关键词"),d.attr("placeholder","搜索书籍/节目/主播"))}else d.val(localStorage.getItem("keyword"))}},document.body.appendChild(a)},r=function(t){var n=$(this),i=n.attr("href");if(n.hasClass("btn-list-more")&&1==n.closest(".tab-content").length){var r=n.data("pagenum"),s=n.prev("ul");r++,n.addClass("btn-loading"),n.data("text",n.find(".btn-load-text").text()),n.find(".btn-load-text").text("正在加载..."),$.ajax({url:i+="&pageNum="+r,success:function(e){n.data("pagenum",r);var t=n.data("maxlength")?parseInt(n.data("maxlength")):10,i=$(e).find(".tab-content>li").eq($(".tab>li.active").index()).find("ul");0==i.length?(s.append(e),$(e).filter("li").length<t&&n.hide()):(s.append(i.html()),i.children().length<t&&n.hide()),a(),n.removeClass("btn-loading"),n.find(".btn-load-text").text(n.data("text"))}}),t.preventDefault()}else if(n.hasClass("btn-list-more")&&0==n.closest(".tab-content").length){var s=n.prev("ul"),l=s.children().last().data("referid");l&&(i+="&referId="+l);var r=n.data("pagenum");r&&(r++,i+="&pageNum="+r,n.data("pagenum",r)),n.addClass("btn-loading"),n.data("text",n.find(".btn-load-text").text()),n.find(".btn-load-text").text("正在加载..."),$.ajax({url:i,success:function(e){var t=$(e).find(".list-container"),i=n.data("maxlength")?parseInt(n.data("maxlength")):10;0==t.length?(s.append(e),$(e).filter("li").length<i&&n.hide()):(s.append(t.html()),t.children().length<i&&n.hide()),a(),n.removeClass("btn-loading"),n.find(".btn-load-text").text(n.data("text"))}}),t.preventDefault()}else if(1==n.closest(".tab").length){var d=n.parent().index(),s=$(".tab-content>li").eq(d);s.addClass("loader");var c=s.next(".btn-list-more").hide();n.removeAttr("href"),$.ajax({url:i,success:function(e){var t=$(e).find(".tab-content>li").eq(d);s.html(t.html()),s.removeClass("loader"),t.find("ul").children().length>=10&&c.show(),a()}}),t.preventDefault()}else if(history.pushState&&!n.attr("_blank")&&"#"!=i&&i.indexOf("http://")==-1&&i.indexOf("https://")==-1&&i.indexOf("javascript")==-1&&i.indexOf("lazyaudio://")==-1){var u=e();void 0==u?(window.location.href=i,window.setupNavBarTitle&&window.setupNavBarTitle(document.title)):o(i),history.pushState("","",i),t.preventDefault()}};setTimeout(function(){window.onpopstate=function(t){var a=$(".dialog"),n=$(".dialog-mask");a.length&&a.remove(),n.length&&n.remove();var i=e();void 0!=i?o(location.href):(window.location.href=location.href,window.setupNavBarTitle&&window.setupNavBarTitle(document.title))}},1e3);var s=$(".g-gotop");$(window).on("scroll",function(){$(window).scrollTop()>$(window).height()?s.show().on("click",function(){$(window).scrollTop(0)}):s.hide()}).on("load",function(){setTimeout(function(){window.scrollTo(0,1)},0)});var l=$(document.body);l.on("touchstart","a",function(){var e=$(this);"false"!=e.attr("data-hover")&&(e.addClass("hover"),setTimeout(function(){$(".hover").removeClass("hover")},500))}).on("click","a[href]",r),$(".wrapper").on("touchstart",".openPopTip",function(e){$(".share-dialog").show();var t="";clearTimeout(t),setTimeout(function(){$(".share-dialog").hide()},3e3),e.preventDefault()}).on("click",".showBigPicBtn",function(e){var t=$(this),a=t.attr("data-itemid"),n=t.attr("data-realPic");new OpenBigPic({url:"/ajax/getBigPicture?entityId="+a+"&entityType=6",realPic:n,successFn:function(e){$("._wrappers").find("img").attr("src",e),t.attr("data-realPic",e)}})})}),function(e){function t(){if(e.playerInfo.index>e.playerInfo.sections.length-1)return void console.log("没有可播放内容");e.playerInfo.index++;var a=e.playerInfo.sections[e.playerInfo.index],n=$(".book-section li.layout-box").eq(e.playerInfo.index);if(n.hasClass("setGray"))return void t();if(a)if("null"==a.path){var i=a.link.split("/")[2].split("?")[0],o=[];o.push(a.id),$.ajax({url:"/ajax/fetchChapterPath",type:"get",data:{entityId:i,entityType:3,opType:0,sections:JSON.stringify(o)},success:function(t){if(0==t.status){var n=t.list[0].path;a.path==n,e.playerInfo&&e.playInfo.setPlayPath(a.id,n),e.lazyMedia.play(a)}else console.log(t.msg)},error:function(e){console.log(e)}})}else e.lazyMedia.play(a)}e.playerInfo={};var a=document.createElement("audio");a.setAttribute("id","audio");var n=$(".player-mini-play"),i=$(".player-mini-pause"),o=$(".player-mini-next"),r=$(".player-mini");n.on("click",function(){a.play()}),i.on("click",function(){a.pause()}),o.on("click",function(){t()}),r.find(".js-link").on("click",function(){$("#resourceId").val()!=e.playerInfo.resourceId&&e.pageload($(this).data("href"))});var s=function(){r.show(),$(".player-mini-wrapper").height(r.height())};e.lazyMedia={beating:function(){if($("#resourceId").val()==e.playerInfo.resourceId){$(".book-section-playing").hide().siblings(".book-section-play").show();var n=$(".book-section li.layout-box").eq(e.playerInfo.index);if(!n.length)return;if(n.hasClass("setGray"))return void t();a.paused?(n.find(".book-section-play").show(),n.find(".book-section-playing").hide()):(n.find(".book-section-play").hide(),n.find(".book-section-playing").show())}},play:function(t){var n=$(".book-section li.layout-box").eq(e.playerInfo.index);if(!(e.playerInfo.index>e.playerInfo.sections.length-1)){if(!n.hasClass("setGray"))for(var i in t)$("#player_"+i).html(t[i]);a.src!=t.path?(a.setAttribute("title",t.name),a.setAttribute("name",t.name),a.src=t.path,r.find(".js-link").data("href",t.link),a.play()):a.paused?a.play():a.pause()}}},a.addEventListener("play",function(){s(),n.hide(),i.show(),lazyMedia.beating()}),a.addEventListener("pause",function(){n.show(),i.hide(),lazyMedia.beating()}),a.addEventListener("ended",function(){o.click()}),e.secondsToTimeCode=function(e,t,a,n){"undefined"==typeof a?a=!1:"undefined"==typeof n&&(n=25);var i=Math.floor(e/3600)%24,o=Math.floor(e/60)%60,r=Math.floor(e%60),s=Math.floor((e%1*n).toFixed(3)),l=(t||i>0?(i<10?"0"+i:i)+":":"")+(o<10?"0"+o:o)+":"+(r<10?"0"+r:r)+(a?":"+(s<10?"0"+s:s):"");return l}}(window),function(){var e={getInfos:function(){return window.playerInfo&&window.playerInfo.sections},getSingleInfo:function(e){for(var t=[],a=0,n=playerInfo.sections.length;a<n;a++)playerInfo.sections[a].id==e&&(t=playerInfo.sections[a]);return t},setPlayPath:function(e,t){for(var a=0,n=playerInfo.sections.length;a<n;a++)playerInfo.sections[a].id==e&&"null"==playerInfo.sections[a].path&&(playerInfo.sections[a].path=t)}};window.playInfo=e}();