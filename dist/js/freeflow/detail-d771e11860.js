/**
 * Date:Sun Nov 27 2016 17:17:12 GMT+0800 (中国标准时间)
 */
define(function(require,exports,module){exports.ready=function(){var e=require("../widgets/alert-cb619f7de4.js"),t=require("../widgets/dialog-d68472dbbc.js"),n={countdown:60,unsubscribeRequireUrl:"/ajax/unsubscribe",subscribeRequireUrl:"/ajax/subscribe",sendCodeRequireUrl:"/ajax/sendLoginCode",qryProductRequireUrl:"/ajax/qryProduct"},o={runApp:function(e){e&&(this.isAboveIos9()?location.href=e:($("body").append('<iframe style="height:0px;visibility:hidden;position:absolute;" src="'+e+'" frameborder="0"></iframe>'),setTimeout(function(){$("iframe").remove()},1e3)))},isAboveIos9:function(){var e=navigator.userAgent;if(e.match(/iPhone|iPad|iPod/i)){var t=e.match(/OS (\d+)_(\d+)_?(\d+)?/);return t=parseInt(t[1],10),t>=9}return!1},getAjax:function(t,n,o){var a=this,i={url:t,type:"get",dataType:"json",timeout:1e4,beforeSend:function(){a.beforeSendAjax()},complete:function(){a.stopSendAjax()},error:function(t,n){a.stopSendAjax(),o&&"function"==typeof o?o():"timeout"==n?e.show("请求超时，请稍后重试",2e3):0==window.navigator.onLine&&e.show("当前无网络，请检查您的网络设置。",2e3)}},r=$.extend(i,{success:function(t){a.stopSendAjax(),console.log(t),0==t.status?n&&"function"==typeof n&&n(t):e.show(t.msg,2e3)}});$.ajax(r)},beforeSendAjax:function(){var e=$(".page-loading-bar");e.show().css("width","80%"),$(".wrapper").removeClass("aside-out").addClass("ff-ajax-loading").css("opacity",.7)},stopSendAjax:function(){var e=$(".page-loading-bar");e.show().css("width","100%"),$(".wrapper").removeClass("ff-ajax-loading").css("opacity",1),setTimeout(function(){e.hide().width(0)},500)},seTimeFn:function(e){var t=e.attr("data-disable");if(0==n.countdown){if("true"===t)return e.text("获取短信验证码").attr("data-disable","false"),void(n.countdown=60)}else e.text(n.countdown+"S后再次获取").attr("data-disable","true"),n.countdown--;setTimeout(function(){o.seTimeFn(e)},1e3)},checkPhone:function(t,o,a){var i=/^1\d{10}$/,r=/^1(3[4-9]|5[012789]|8[23478]|4[7]|7[8])\d{8}$/,s=/^1(3[3])|(8[019])\d{8}$/;if(""==t)return e.show("手机号码不能为空",2e3),!1;if(!i.test(t))return e.show("格式不正确，请输入11位手机号码",2e3),!1;if(r.test(t)||s.test(t))return e.show("非联通号码不能开通",2e3),!1;if(o&&"true"!==o.attr("data-disable")){var c=n.sendCodeRequireUrl+"?phone="+t;0==a&&(c=n.sendCodeRequireUrl+"?trial=1&phone="+t),this.sendCodeFn(c,o)}return!0},sendCodeFn:function(e,t){this.getAjax(e,function(e){o.seTimeFn(t)})},isType:function(e){return function(t){return{}.toString.call(t)==="[object "+e+"]"}},parseUrl:function(e){if(this.isType("String")(e)){e=decodeURI(e);for(var t,n={},o=/([^#?=&]+)=([^&]+)/gi;null!=(t=o.exec(e));)n[t[1]]=t[2];return n}},parseObj2Str:function(e){var t="";if(this.isType("Object")(e)){for(var n in e)e.hasOwnProperty(n)&&e[n]&&"source"!=n&&(t+=n+"="+encodeURI(e[n])+"&");return t.replace(/&$/,"")}return e},mergeObject:function(e,t){return $.extend({},e,t)},getValInObject:function(e,t){for(var n in t)if(n==e)return t[n];return""},notifyApp:function(e){if(this.isAboveIos9())try{window.receiveFinishNotification&&"function"==typeof window.receiveFinishNotification&&window.receiveFinishNotification(e)}catch(t){}else o.runApp(e)}},a={init:function(){this.bindSubscribeEvent()},getAppParamsForDom:function(){return $(".J_freeflow_opened").attr("data-val")},getSourceForDom:function(){return $(".J_freeflow_opened").attr("data-source")},subscribeSuccessFn:function(e,t){var n=this.getAppParamsForDom(),a=e.state,i="";n.indexOf("source")==-1&&(i=this.getSourceForDom());var r=e.phone,s=e.access_token,a=e.state,c=e.trialState,u=e.msg||"",f=e.endDate||"",r=e.phone,l={};if(l.access_token=s,l.phone=r,l.state=a,l.trialState=c,l.msg=u,t)var d="lazyaudio://flowfree?phone="+r+"&access_token="+s+"&trialState="+c;else var d="lazyaudio://flowfree?phone="+r+"&access_token="+s+"&state="+a;o.notifyApp(d);var h=this.updateAppParams(l,n),b="";b=t?"/freeflow/order/"+a+"?endDate="+f+"&"+h+"&"+i:"/freeflow/order/"+a+"?"+h+"&"+i,window.location.href=b},updateAppParams:function(e,t){var n=o.parseUrl(t)||{};(n.beginDate||n.endDate||n.phone)&&(delete n.beginDate,delete n.endDate,delete n.phone),n.msg&&delete n.msg;var a=o.mergeObject(n,e);return o.parseObj2Str(a)},openConmfimDialog:function(e,n){var a=this,i=$(".J_freeflow_opened").attr("data-isTrial");if(0==i){var r={title:"确认开通",bodyHtml:"开通试用服务后，72 小时内退订不会扣费，如未在试用期内退订，将会自动正式订购。",btnLeft:"暂不开通",btnRight:"继续开通",isAutoClose:0,gotoIndexCallBack:function(){},gotoDetailCallBack:function(){o.getAjax(n+"&trial=1",function(e){a.subscribeSuccessFn(e,!0)})}},s=new t(r);s.show()}else if("true"===e){var r={title:"确认开通",bodyHtml:"订购需花费8元/月，开通后立即生效且每月月初自动续费。",btnLeft:"暂不开通",btnRight:"继续开通",isAutoClose:0,gotoIndexCallBack:function(){},gotoDetailCallBack:function(){o.getAjax(n,function(e){a.subscribeSuccessFn(e)})}},s=new t(r);s.show()}else{var r={title:"确认激活",bodyHtml:"已开通用户不会重复扣费，未开通用户需花费8元/月。",btnLeft:"暂不激活",btnRight:"继续激活",isAutoClose:0,gotoIndexCallBack:function(){},gotoDetailCallBack:function(){o.getAjax(n.replace(/&$/,"")+"&trial=3",function(e){a.subscribeSuccessFn(e)})}},s=new t(r);s.show()}},bindSubscribeEvent:function(){var t=this;$("#freeflow_info_num").on("click",function(){var e=$(".J_check_phone").val(),t=$(this),n=$(".J_freeflow_opened").attr("data-isTrial");o.checkPhone(e,t,n)}),$(".J_freeflow_opened").on("click",function(){var a=0,i="",r=$(this),s=(r.attr("data-phone"),r.attr("data-isOrder")),c=t.getAppParamsForDom();a=$(".J_check_phone").val();var u=o.checkPhone(a,null);if(u){var f=$(".J_check_verifyCode").val();if(!f)return void e.show("请您输入验证码",2e3);var l=($(".J_freeflow_opened").attr("data-isTrial"),o.parseUrl(c));l.phone&&(l.phone="",c=o.parseObj2Str(l)),i=encodeURI(n.subscribeRequireUrl+"?phone="+a+"&verify_code="+f+"&"+c),t.openConmfimDialog(s,i)}})}},i={init:function(){this.bindEvent()},getDataSource:function(){return $(".J_unsubscribe_btn").attr("data-source")},geteSlectItem:function(){for(var e,t=$(".ff-unsubscribe-ul").find(".ff-unsubscribe-selected"),n=t.length,o=[],a=0;a<n;a++)e=$(t[a]).prev().attr("data-type"),o.push(e);return o.join(",")},successCallBackFn:function(e,a,i){var r=a.state,s=(a.trial,a.trialState),c=this.getDataSource()||"",u=o.parseUrl(e);u.source&&(c=""),u.trialState&&(u.trialState=s);var f={};f=i?{title:"确认退订",bodyHtml:"√退订中,请稍后留意短信。如需要继续使用请正式开通。",btnLeft:"我知道了",btnRight:"",gotoIndexCallBack:function(){if(u.access_token)var e=u.access_token;var t="/freeflow?access_token="+e+"&"+c;window.location.href=t}}:{title:"确认退订",bodyHtml:"退订中,请稍后留意短信。退订成功后您还可以使用该服务至月底。",btnLeft:"我知道了",btnRight:"查看详情",gotoIndexCallBack:function(){window.location.href="/freeflow?"+e+"&"+c},gotoDetailCallBack:function(){var t=u.access_token,a=u.beginDate,i=u.token,r=u.phone,s=n.qryProductRequireUrl+"?access_token="+t+"&token="+i+"&phone="+r;o.getAjax(s,function(t){var n=t.state,o="";a?window.location.href="/freeflow/order/"+n+"?"+e+"&"+c:(a=t.beginDate,endDate=t.endDate,o=t.msg||"",window.location.href="/freeflow/order/"+n+"?"+e+"&beginDate="+a+"&endDate="+endDate+"&"+c+"&msg="+o)})}};var l=new t(f);l.show();var d=u.phone,h=u.access_token,s=u.trialState;if(i)var b="lazyaudio://flowfree?phone="+d+"&access_token="+h+"&trialState="+s;else var b="lazyaudio://flowfree?phone="+d+"&access_token="+h+"&state="+r;o.notifyApp(b)},bindEvent:function(){var t=this;$(".ff-unsubscribe-ul li").on("touchstart",function(){var e=$(this).find(".ff-unsubscribe-icon-right"),t="ff-unsubscribe-selected";e.parent().parent().siblings("li").find(".ff-unsubscribe-icon-right").removeClass(t),e.hasClass(t)?e.removeClass(t):e.addClass(t)}),$(".J_unsubscribe_btn").on("click",function(){var a=$(this).attr("data-val"),i=$(this).hasClass("trialBtn"),r="";if(i)r=n.unsubscribeRequireUrl+"?"+a+"&trial=1";else{var s=$(".ff-unsubscribe-selected").parent().siblings(".box-cols").attr("data-type")||"",c=$(".J_unsubscribe_code").val();if(!c)return void e.show("请您输入验证码",2e3);r=n.unsubscribeRequireUrl+"?reason="+s+"&"+a+"&verify_code="+c}r=encodeURI(r),$(".wrapper").length&&$(".wrapper").addClass("ff-ajax-loading"),o.getAjax(r,function(e){t.successCallBackFn(a,e,i)})}),$("#ff_check_info").on("click",function(){var e=parseInt($("#unsubscrubePhoneNum").html(),10),t=n.sendCodeRequireUrl+"?phone="+e,a=$(this).attr("data-disable");"true"!==a&&o.sendCodeFn(t,$(this))})}};a.init(),i.init()}});