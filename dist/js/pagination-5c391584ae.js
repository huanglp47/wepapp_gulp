/**
 * Date:Sun Nov 27 2016 17:17:12 GMT+0800 (中国标准时间)
 */
define(function(require,exports,module){function e(e,t){this.listNum=1,this.pageNum=1,this.pageSize=t||20,this.selectPage=1,this.bookId=e,this.initPage()}var t='<a id="J_first_num" class="{isFirstGray}" data-href="" >上一页</a><a class="mySelect"><span id="J_currentPaging" class="cur_page">{currentPage}/{pageNum}</span><em class="page_arrow"></em><select class="pagination-select" id="J_paging_select" data-current-page="{currentPage}">{selectOptions}</select></a><a id="J_last_num" class="{isLastGray}" data-href="">下一页</a>',a='<li class="layout-box"><div class="box-cols"><div class="nowrap">{listName}</div></div><div><a class="book-section-playing hide"><img src="/images/playing/01-53851bc871.png"></a><a class="book-section-play"><i class="iconfont"></i></a></div><input type="hidden" name="path" value="{listPath}"><input type="hidden" name="name" value="{listName}"><input type="hidden" name="id" value="{listAudioId}"><input type="hidden" name="bookName" value="{listName}"><input type="hidden" name="link" value="{link}"></li>';e.prototype={initPage:function(){this.render()},getLocalDataById:function(){var e=[],t=null,a=null;if(!this.bookId)throw new Error("bookId is required!");return this.data=window.localStorage.getItem(this.bookId),this.data&&(this.data=JSON.parse(this.data),this.listNum=this.data.length||0,this.pageNum=Math.ceil(this.listNum/this.pageSize),t=parseInt((this.selectPage-1)*this.pageSize+1),a=parseInt(this.selectPage*this.pageSize)+1,e=this.data.slice(t,a)),e},render:function(){this.goToselectUrl(),this.bindEventForSelect()},outputHtml:function(){var e=0,a=0,i="",s="",n=$("#J_album_paging"),l=this.selectPage>1?"":"btn-gray",o=this.selectPage==this.pageNum?"btn-gray":"";for(a=this.pageNum;e<a;e++)s+="<option value="+(e+1)+' data-href="" class="layout-box">'+(e+1)+"</option>";i=t.replace(/{isFirstGray}/g,l).replace(/{currentPage}/g,this.selectPage).replace(/{pageNum}/g,this.pageNum).replace(/{isLastGray}/g,o).replace(/{selectOptions}/g,s),n.html(i)},goToselectUrl:function(){this.renderData(),this.outputHtml()},stopPropagation:function(e){e.preventDefault(),e.stopPropagation()},renderData:function(){for(var e="",t=$(".book-section ul"),i=this.getLocalDataById(this.bookId),s=0,n=i.length;s<n;s++)e+=a.replace(/{listName}/g,i[s].name).replace(/{listPath}/g,i[s].path).replace(/{listAudioId}/g,i[s].id).replace(/{listName}/g,i[s].name).replace(/{link}/g,i[s].link);t.html(e)},bindEventForSelect:function(){var e=this;$("#J_album_paging").on("click","#J_first_num",function(t){var a=$(this);a.hasClass("btn-gray")||(e.selectPage=e.selectPage-1,e.goToselectUrl(e.selectPage),e.stopPropagation(t))}).on("click","#J_last_num",function(t){var a=$(this);a.hasClass("btn-gray")||(e.selectPage=parseInt(e.selectPage,10)+1,e.goToselectUrl(e.selectPage),e.stopPropagation(t))}).on("click","#J_paging_select",function(t){var a=($(this),$("#J_currentPaging"));a.addClass("opacity1"),e.stopPropagation(t)}).on("change","#J_paging_select",function(t){var a=$(this);a.find("option:selected").attr("data-href"),parseInt(a.attr("data-current-page"));e.selectPage=parseInt(a.val()),e.goToselectUrl(e.selectPage)})}},module.exports=e});