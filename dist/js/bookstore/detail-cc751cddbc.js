/**
 * Date:Sun Nov 27 2016 17:17:12 GMT+0800 (中国标准时间)
 */
define(function(require,exports,module){exports.ready=function(){function o(){var o=navigator.userAgent;if(o.match(/iPhone|iPad|iPod/i)){var a=o.match(/OS (\d+)_(\d+)_?(\d+)?/);return a=parseInt(a[1],10),a>=9}return!1}function a(){var o=[];return $(".book-section li.layout-box").each(function(){var a=$(this),i={};a.find("input[type=hidden]").each(function(){var o=$(this);i[o.attr("name")]=o.val()}),o.push(i)}),o}function i(o){var a={};return o.find("input[type=hidden]").each(function(){var o=$(this);a[o.attr("name")]=o.val()}),a}function e(){var o=$(".book-item-photo img").attr("src"),a=$("#bookName").val(),i=$("#bookType").val(),e=$("#bookSections").val(),n=$("#bookAuthor").val(),t=$("#bookPlay").val(),r=$("#bookAnnouncer").val(),s=$("#bookDesc").text();return{bookPhoto:o,bookName:a,bookType:i,bookSections:e,bookAuthor:n,bookPlay:t,bookAnnouncer:r,bookType:i,bookDesription:s}}function n(o){var a=JSON.stringify(o);window.H5VideoJs&&window.H5VideoJs.openVideo(a)}function t(o){var t=window.location.search;if(t.indexOf("batchplay")>-1){var r=(i(o),a(o)),s=e(),l=parseInt(o.index())+1,d={index:l,bookInfo:s,list:r};n(d)}}function r(){var o={},i=a(),t=e();o={index:1,bookInfo:t,list:i},n(o)}function s(o,a){for(var i=0;i<v.length;i++)v[i].id==o&&(a&&"null"==v[i].path&&(v[i].path=a),console.log(v),window.playerInfo.index=i,window.lazyMedia.play(window.playerInfo.sections[i]))}function l(){var o=$("#J_pagination_select"),a=o.attr("data-current-page");$("#J_pagination_select option").eq(a-1).attr("selected","true")}function d(o){window.location.href=o}window.lazyMedia.beating(),$("iframe").remove();var c=$("#runapp").val(),p=$(".share-dialog");if(window.browser.isWebchat)window.browser.android&&p.find("span").eq(0).hide(),window.browser.ios&&p.find("span").eq(1).hide();else if(c&&window.location.search.indexOf("runapp")>-1){navigator.userAgent;o()?location.href=c:($("body").append('<iframe style="height:0px;visibility:hidden;position:absolute;" src="'+c+'" frameborder="0"></iframe>'),setTimeout(function(){$("iframe").remove()},1e3))}p.on("click",function(o){o.target==p[0]&&p.hide()}),$(".book-info-opertion a").on("click",function(a){$(this);if(window.browser.isWebchat||window.browser.isWeiboChat)p.show().height($("body").height());else if(c){navigator.userAgent;o()?(location.href=c,setTimeout(function(){location.href="/about/download"},2500)):($("body").append('<iframe style="height:0px;visibility:hidden;position:absolute;" src="'+c+'" frameborder="0"></iframe>'),setTimeout(function(){location.href="/about/download"},2500))}a.preventDefault()}),$(".book-desc-all").click(function(){$(this).closest("p").hide().siblings("p").show()}),$("#load-more").on("click",function(){$(this).prev().children(".hide").removeClass("hide"),$(this).hide().next("a").show()}),$("#J_loadMore").on("click",function(){var o=$(this),a=o.attr("data-id"),i=parseInt(o.attr("data-num"))+1,e=o.attr("data-size"),n="/ajax/BookLoadMore?bookId="+a+"&pageNum="+i+"&pageSize="+e;u(n,o)});var u=function(o,a){$.ajax({url:o,type:"get",data:{},success:function(o){console.log(o),h(o,a)},error:function(o){console.log(o)}})},h=function(o,i){var e=i.attr("data-num"),n=parseInt(e)+1;i.attr("data-num",n);for(var t="",r=$("#bookName").val(),s='<li class="layout-box"><div class="box-cols"><div class="nowrap">{name}</div></div><div><a class="book-section-playing hide"><img src="/images/playing/01-53851bc871.png"  /></a><a class="book-section-play"><i class="iconfont callplay">&#xe62e</i></a></div><input type="hidden" name="path" value="{path}"/><input type="hidden" name="name" value="{name}"/><input type="hidden" name="id" value="{id}"/><input type="hidden" name="bookName" value="{bookName}" /><input type="hidden" name="link" value="{link}" /></li>',l=0,d=o.list.length;l<d;l++)t+=s.replace(/{name}/g,o.list[l].name).replace(/{path}/g,o.list[l].path).replace(/{id}/g,o.list[l].id).replace(/{bookName}/g,r).replace(/{link}/g,"/book/"+o.bookId+"?title="+r);if(i.siblings("ul").append(t),v=a(),o.list.length<20)return i.siblings("a").show(),void i.hide()},f=$("#resourceId").val(),v=a(),b=function(){window.playerInfo.sections=v,window.playerInfo.resourceId=f};document.getElementById("audio");$(".book-item-photo i").on("click",function(){var o=window.location.search;return o.indexOf("batchplay")>-1?void r():void($(this).parents().hasClass("J_auduio_play")||$(this).parents().hasClass("J_group_spe")||(b(),window.playerInfo.index=0,window.lazyMedia.play(v[0])))}),$(".J_auduio_play").on("click",function(){var o=$(this).attr("data-id");b();for(var a=0;a<v.length;a++)v[a].id==o&&(window.playerInfo.index=a,window.lazyMedia.play(window.playerInfo.sections[a]))}),$(".book-section").on("click",".layout-box",function(o){var a=$(this),i=($(o.target),window.location.search);if(!(a.hasClass("setGray")||(t(a),i.indexOf("batchplay")>-1||window.location.pathname.indexOf("album")>-1&&$(o.target).parents("div").hasClass("box-cols")))){var e=$(".player-mini-wrapper");e.show(),b(),$(".book-section-playing").hide(),$(".book-section-play").show();var n=a.find("input[name=id]").val();if("null"==window.playInfo.getSingleInfo(n).path){var r=$("#resourceId").val().split("_")[1],l=[];l.push(n),$.ajax({url:"/ajax/fetchChapterPath",type:"get",data:{entityId:r,entityType:3,opType:0,sections:JSON.stringify(l)},success:function(o){if(0==o.status){var a=o.list[0].path;s(n,a)}else console.log(o.msg)},error:function(o){console.log(o)}})}else s(n)}}),$("#J_pagination_select").change(function(){var o=$(this),a=o.find("option:selected").attr("data-href"),i=o.attr("data-current-page"),e=o.val();e!=i&&d(a)}),$("#J_paging_select").change(function(){var o=$(this),a=o.find("option:selected").attr("data-href"),i=o.attr("data-current-page"),e=o.val();e!=i&&d(a)}),l(),$("#J_top").click(function(){var o=$(this).attr("data-href");o&&d(o)}),$("#J_down").click(function(){var o=$(this).attr("data-href");o&&d(o)}),$("#J_pagination_select").click(function(o){var a=$(this),i=$("#cur_page").text(),e=a.find("options:selected").text();e!=i&&(a.addClass("opacity1"),o.stopPropagation())}),$(".J_batchplay",".book-section").on("click",function(){r()})}});