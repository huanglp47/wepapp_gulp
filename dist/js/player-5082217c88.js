/**
 * Date:Sun Nov 27 2016 17:17:12 GMT+0800 (中国标准时间)
 */
define(function(require,exports,module){exports.audio=$("#audio"),exports.player=$(".player"),exports.play=exports.player.find(".play"),exports.next=exports.player.find(".next"),exports.init=function(){exports.bind()},exports.bind=function(){exports.play.on("click",function(){exports.play.hasClass("icon-play")?exports.audio[0].play():exports.audio[0].pause()}),exports.next.on("click",function(){$.ajax({url:"/player/getUrl",data:{id:window.audioData.id,type:5},async:!1,success:function(a){"success"==a.status&&(exports.audio[0].src=a.data.url,exports.audio[0].play(),window.audioData=$.extend(window.audioData,a.data),localStorage.setItem("audioData",JSON.strinigfy(window.audioData)))}})}),exports.audio.on("play",function(){exports.play.addClass("icon-pause").removeClass("icon-play"),$(document.body).addClass("player-show"),exports.setPlayerInfo()}),exports.audio.on("pause",function(){exports.play.addClass("icon-play").removeClass("icon-pause")}),exports.audio.on("progress",function(a){var o=this,t=void 0!=a?a.target:o.media,e=null;t&&t.buffered&&t.buffered.length>0&&t.buffered.end&&t.duration?e=t.buffered.end(0)/t.duration:t&&void 0!=t.bytesTotal&&t.bytesTotal>0&&void 0!=t.bufferedBytes?e=t.bufferedBytes/t.bytesTotal:a&&a.lengthComputable&&0!=a.total&&(e=a.loaded/a.total),null!==e&&(e=Math.min(1,Math.max(0,e)),exports.player.find(".player-loaded").css("width",100*e+"%"))}),exports.audio.on("timeupdate",function(){exports.player.find(".player-time").text(exports.secondsToTimeCode(audio.currentTime))}),exports.audio.on("ended",function(){exports.next.click()})},exports.setPlayerInfo=function(){exports.player.find(".player-title").text(window.audioData.name),exports.player.find(".player-author").text(window.audioData.author),exports.player.find("img").attr("src",window.audioData.cover),exports.player.find(".player-info").attr("href","/bookstore/detail/"+window.audioData.parentId),$("#section-"+window.audioData.id).addClass("player-active").siblings().removeClass("player-active")},exports._play=function(a){$.ajax({url:"/player/getUrl",data:{id:a,type:6},async:!1,success:function(a){"success"==a.status&&exports.audio[0].src!=a.data.url&&(window.audioData=a.data,exports.audio[0].pause(),exports.audio[0].src=a.data.url,exports.audio[0].play(),window.audioData.cover=$("#cover").val(),window.audioData.author=$("#author").val(),localStorage.setItem("audioData",JSON.stringify(window.audioData)))}})},exports.secondsToTimeCode=function(a,o,t,e){"undefined"==typeof t?t=!1:"undefined"==typeof e&&(e=25);var i=Math.floor(a/3600)%24,d=Math.floor(a/60)%60,n=Math.floor(a%60),u=Math.floor((a%1*e).toFixed(3)),l=(o||i>0?(i<10?"0"+i:i)+":":"")+(d<10?"0"+d:d)+":"+(n<10?"0"+n:n)+(t?":"+(u<10?"0"+u:u):"");return l},localStorage.getItem("audioData")&&(window.audioData=JSON.parse(localStorage.getItem("audioData"))),exports.init()});